/*!uglify*/
define(function(require,exports,module){require("jquery"),$(function(){function pick(){$(".comSame").each(function(){var replyCon=$(this).find(".replyCon"),replyConFirst=replyCon.eq(0),num=replyCon.length,pTxt=$(this).find(".replyWapper>p"),replyBox=$(this).find(".replyBox");replyCon.hide(),pTxt.remove(),replyConFirst.show(),replyCon.parents(".replyWapper").append('<p class="totalReNum"><span>共'+num+"条回复 ></span></p>"),replyBox.addClass("hasMore"),replyBox.parents(".comCon").addClass("replyDone")})}function parseDom(str){var objE=document.createElement("div");return objE.className="comSame fix",objE.innerHTML=str,objE}function getTime(){var time=new Date,hours=time.getHours(),minutes=time.getMinutes(),seconds=time.getSeconds();return hours=hours>10?hours:"0"+hours,minutes=minutes>10?minutes:"0"+minutes,seconds=seconds>10?seconds:"0"+seconds,time.getFullYear()+"-"+(time.getMonth()+1)+"-"+time.getDate()+" "+hours+":"+minutes+":"+seconds}function controlTxt(con,changeNum,totalnum){con.on("keyup",function(){var tVal=$(this).val(),len=getByteLen(tVal),num=Math.ceil(len/2);if(num>totalnum){for(var en=0,j=0;j<tVal.length;j++){var a=tVal.charAt(j);null==a.match(/[^\x00-\xff]/gi)&&(en+=1)}return en=Math.floor(en/2),$(this).val(tVal.substring(0,totalnum+en)),changeNum.html(totalnum),!1}changeNum.html(num)})}function getByteLen(val){for(var len=0,i=0;i<val.length;i++){var a=val.charAt(i);len+=null!=a.match(/[^\x00-\xff]/gi)?2:1}return len}function moreHide(){$(".comTxt").each(function(index){$(this).height()>78&&0==$(this).find("span").length&&$(".comTxt").eq(index).addClass("active").append("<span>展开</span>")}),$(".replyTxt").each(function(index){$(this).height()>78&&0==$(this).find("span").length&&$(".replyTxt").eq(index).addClass("active").append("<span>展开</span>")})}function unScroll(){var top=$(document).scrollTop();$(document).on("scroll.unable",function(e){$(document).scrollTop(top)})}function removeUnScroll(){$(document).unbind("scroll.unable")}function setPic(){var setImgList=$(".drSetPic img");setImgList.each(function(index){var _this=$(this);_this.css({width:"auto",height:"auto"});var CWidth=_this.parent().width(),Cheight=_this.parent().height(),image=new Image;image.onload=function(){var iWidth=this.width,iheight=this.height;iWidth/CWidth>iheight/Cheight?(_this.css({height:"100%",width:"auto"}),_this.css({left:"50%",top:0,marginTop:0,marginLeft:-(_this.width()/2)+"px"})):iWidth/CWidth==iheight/Cheight?(_this.css({height:"100%",width:"100%"}),_this.css({left:"0",top:0,marginTop:0,marginLeft:0})):(_this.css({width:"100%",height:"auto"}),_this.css({left:0,top:"50%",marginTop:-(_this.height()/2)+"px",marginLeft:0}))},image.src=this.src})}function lunbo(ul,arr){var proL=ul,arr=(proL.parent(),arr),lis=proL.children(),liWidth=lis.width(),flag=!0,pic=0;proL.append(lis.eq(0).clone(!0)),setPic(),proL.width((lis.size()+1)*liWidth),arr.find(".arrowRight").off("click").on("click",function(){if(flag){flag=!1,pic==lis.length&&(pic=0,proL.css("left",0)),pic++;var target=-liWidth*pic+"px";proL.stop(!1,!1).animate({left:target},1e3,function(){flag=!0})}return!1}),arr.find(".arrowLeft").off("click").on("click",function(){if(flag){if(flag=!1,0==pic){pic=lis.length;var img=-liWidth*pic;proL.css("left",img)}pic--;var target=-liWidth*pic+"px";proL.stop(!1,!1).animate({left:target},500,function(){flag=!0})}return!1})}function ajaxLogin(){$(".dr_Registsign,.dr_blackwall").show(),$("#papLogin").attr("src","https://passport.darryring.com/other"),window.loginInterval=setInterval(function(){$.get("/ajax/login",function(res){res.result>=0&&(clearInterval(window.loginInterval),location.reload())})},2e3)}!function(doc,win){var docEl=doc.documentElement,resizeEvt="orientationchange"in window?"orientationchange":"resize",recalc=function(){if(clientWidth=docEl.clientWidth,clientWidth){var myclientWidth=clientWidth;myclientWidth>=1024&&(myclientWidth=480),docEl.style.fontSize=20*(myclientWidth/360)+"px",document.body}};recalc(),doc.addEventListener&&(win.addEventListener(resizeEvt,recalc,!1),doc.addEventListener("**DOMContentLoaded**",recalc,!1))}(document,window),setPic(),$(".drfans_att #proLunbo li").size()>1?($(".drfans_att .lunboArrow").show(),lunbo($(".drfans_att #proLunbo"),$(".drfans_att .lunboArrow"))):$(".drfans_att .lunboArrow").hide(),$(".drfans_guess #proLunbo2 li").size()>1?($(".drfans_guess .lunboArrow").show(),lunbo($(".drfans_guess #proLunbo2"),$(".drfans_guess .lunboArrow"))):($(".drfans_guess .lunboArrow").hide(),$(".drfans_att .lunboArrow").hide()),$(".share_wx").off("click").on("click",function(){return $.get(shareCountUrl,{id:postId,type:"wx"},function(res){$(".dr_sametcborder img").attr("src",wxShareUrl),$(".wx_tc,.dr_blackwall").show()},"json"),unScroll(),!1}),$(".share_wb").off("click").on("click",function(){$.get(shareCountUrl,{id:postId,type:"wx"},function(res){window.open(wbShareUrl)},"json")}),$(".share_qq").off("click").on("click",function(){$.get(shareCountUrl,{id:postId,type:"wx"},function(res){window.open(qqShareUrl)},"json")}),$(".wx_tc .tc_isclose").off("click").on("click",function(){return $(".dr_sametc,.dr_blackwall").hide(),removeUnScroll(),!1}),$(".drfans_com").off("click").on("click",".zanNum",function(){if(!isLogin)return ajaxLogin(),!1;var _this=$(this),id=_this.attr("data-id"),type=_this.hasClass("zandone")?1:0;$.get(replyCommentPraiseUrl,{id:id,type:type},function(res){return res.result==-2?(ajaxLogin(),!1):void(_this.hasClass("zandone")?(_this.html(res.praise_num),_this.removeClass("zandone")):(_this.html(res.praise_num),_this.addClass("zandone")))},"json")}),pick(),$("body").off("click").on("click",".commentNum",function(){var reBox=$(this).parents(".comCon"),reCon=$(this).parents(".replyBox"),replyWapper=($(this).parents(".comPart").find(".comSame"),$(this).parents(".comCon").find(".replyWapper")),userName=reBox.find(".userName").html();$(".comCon .comArea").hide(),$(this).hasClass("reply")&&(userName=$(this).parents(".replyCon").find(".replyTxt a").html());var reply_user_id=$(this).attr("reply-user-id"),comment_id=$(this).attr("comment-id");if(replyWapper.find(".toTop").length)replyWapper.find(".toTop").remove(),replyWapper.find(".replyCon").show(),replyWapper.append('<div class="comArea fix"><textarea class="comWord userReply">回复'+userName+'：</textarea><span class="textCount fl"><i>0</i>/200</span><span class="comBtn fr" reply-user-id='+reply_user_id+" comment-id="+comment_id+">评论</span></div>"),replyWapper.append('<p><span class="toTop">收起 ∧</span></p>');else if(reBox.hasClass("replyDone")){if(reBox.hasClass("replyDone")){var pTxt=replyWapper.find(".totalReNum");if(pTxt.remove(),reCon.find(".comArea").length)return void reCon.find(".comArea").show();replyWapper.length||(replyWapper=$(this).parents(".comCon").find(".replyWapper")),replyWapper.append('<div class="comArea fix"><textarea class="comWord userReply">回复'+userName+'：</textarea><span class="textCount fl"><i>0</i>/200</span><span class="comBtn fr" reply-user-id='+reply_user_id+" comment-id="+comment_id+">评论</span></div>"),replyWapper.append(pTxt)}}else{if(reCon.find(".comArea").length)return void reCon.find(".comArea").show();reBox.append('<div class="replyBox"><div class="comArea fix"><textarea class="comWord userReply">回复'+userName+'：</textarea><span class="textCount fl"><i>0</i>/200</span><span class="comBtn fr" reply-user-id="'+reply_user_id+'" comment-id="'+comment_id+'">评论</span></div></div>')}controlTxt(reBox.find(".userReply"),reBox.find(".textCount i"),200),$(".comCon .comBtn").off("click").on("click",function(){if(!isLogin)return ajaxLogin(),!1;var _this=$(this),replyTxt=_this.parents(".comArea").find(".userReply").val(),comment_id=_this.attr("comment-id"),reply_user_id=_this.attr("reply-user-id");$.post(addReplyCommentUrl,{content:replyTxt,parent_id:comment_id,post_id:postId,reply_user_id:reply_user_id},function(res){if(res.result==-2)return ajaxLogin(),!1;if(res.result>0){var pTxt,replyBox=_this.parents(".replyBox"),comCon=replyBox.parents(".comCon"),replyWapper=replyBox.find(".replyWapper");replyBox.find(".replyWapper>p").length?(pTxt=replyBox.find(".replyWapper>p"),pTxt.remove()):pTxt='<p><span class="toTop">收起 ∧</span></p>',replyBox.find(".comArea").remove();var inCon='<div class="replyCon"><p class="replyTxt"><a href="javascript:;">'+res.data.nickname+"</a>"+replyTxt+'</p><div class="txtUp">∧收起</div><div class="fix"><span class="comTime fl">'+getTime()+'</span><span class="comNum fr"><a href="javascript:;" class="commentNum" reply-user-id='+res.data.reply_user_id+" comment-id="+res.data.parent_id+'>回复</a><a href="javascript:;" class="zanNum">0</a></span></div></div>';if(comCon.hasClass("replyDone")?replyWapper.append(inCon):(inCon='<div class="replyWapper">'+inCon+"</div>",replyBox.append(inCon)),comCon.addClass("replyDone"),replyBox.find(".replyCon").length>1&&(replyBox.addClass("hasMore"),replyWapper.append(pTxt),replyWapper.find(".totalReNum").length)){var num=replyWapper.find(".replyCon").length;replyWapper.find(".totalReNum").html("共"+num+"条回复")}moreHide()}return res.result==-1?(alert(res.message),!1):void 0},"json")})}),moreHide(),$(".comPart").off("click").on("click",".comTxt span,.replyTxt span",function(){var _this=$(this),up=_this.parents("p").siblings(".txtUp");_this.parents("p").removeClass("active"),up.show(),up.off("click").on("click",function(){_this.show(),_this.parents("p").addClass("active"),up.hide()}),_this.hide()}),$(".drfansArt_wrapper").off("click").on("click",".replyWapper .totalReNum,.replyWapper .toTop",function(){if($(this).hasClass("totalReNum")){var _this=$(this),comSame=_this.parents(".comSame").siblings();comSame.each(function(){var replyCon=$(this).find(".replyCon"),replyConFirst=replyCon.eq(0),num=replyCon.length,pTxt=$(this).find(".replyWapper>p");replyCon.hide(),pTxt.remove(),replyConFirst.show(),replyCon.parents(".replyWapper").append('<p class="totalReNum"><span>共'+num+"条回复 ></span></p>")});var replyWapper=_this.parents(".replyWapper");_this.parents(".comSame").siblings().find(".comArea").hide(),replyWapper.find(".comArea").show(),replyWapper.find(".replyCon").show(),_this.remove(),replyWapper.append('<p><span class="toTop">收起 ∧</span></p>')}if($(this).hasClass("toTop")){var replyCon=$(this).parents(".replyWapper").find(".replyCon"),replyConFirst=replyCon.eq(0),num=replyCon.length;$(this).parents(".replyWapper").find(".replyCon").hide(),$(this).parents(".replyWapper").find(".comArea").hide(),replyConFirst.show(),$(this).parents(".replyWapper").append('<p class="totalReNum"><span>共'+num+"条回复 ></span></p>"),$(this).remove()}}),$("#usercom").on("focus",function(){$(".comTips").hide(),$(".comCon .comArea").hide()}).on("blur",function(){"0"===$(".comForm .textCount i").html()&&$(".comTips").show()}),controlTxt($("#usercom"),$(".comForm .textCount i"),200),$(".comForm .comBtn").off("click").on("click",function(){var replyPic=$(".comForm .comPic").html(),replyTxt=$("#usercom").val();return isLogin?replyTxt?void $.post(addReplyCommentUrl,{content:replyTxt,parent_id:0,post_id:postId},function(res){if(res.result==-2)return ajaxLogin(),!1;if(!(res.result>0))return alert(res.message),!1;var insertString='<div class="comPic drSetPic fl">'+replyPic+'</div><div class="comCon fr"><span class="userName">'+res.data.nickname+'</span><p class="comTxt">'+replyTxt+'</p><div class="txtUp">∧收起</div><div class="cominfo fix"><span class="comTime fl">'+getTime()+'</span><span class="comNum fr"><a href="javascript:;" class="commentNum" reply-user-id="'+res.data.user_id+'" comment-id="'+res.data.id+'">回复</a><a href="javascript:;" class="zanNum">0</a></span></div></div>',insertDom=parseDom(insertString),fartherNode=($(".comPart .comSame").eq(0),document.getElementById("comPart"));fartherNode.insertBefore(insertDom,fartherNode.childNodes[0]),moreHide(),$("#usercom").val(""),$(".comForm .comTips").show(),$(".comForm .textCount i").html("0");var comments_num=Number($(".drfans_com").find("i").html())+1;$(".drfans_com").find("i").text(comments_num)},"json"):(alert("内容不能为空"),!1):(ajaxLogin(),!1)}),$("body").on("click","#page .Topage_first",function(){var page=Number($("#page .active").text());return!(page<=1)&&void $.get(replyCommentUrl,{page:1},function(res){$(".container").html(res),setPic()})}),$("body").on("click","#page #last",function(){var page=Number($("#last").data("info"));$.get(replyCommentUrl,{page:page},function(res){$(".container").html(res),setPic()})}),$("body").on("click","#page #previous",function(){var page=Number($("#page .active").text());return!(page<=1)&&(page-=1,void $.get(replyCommentUrl,{page:page},function(res){$(".container").html(res),setPic()}))}),$("body").on("click","#page #next",function(){var page=Number($("#page .active").text());$.get(replyCommentUrl,{page:page+1},function(res){$(".container").html(res),setPic()})}),$("body").on("click","#page em",function(){var page=Number($(this).text());$.get(replyCommentUrl,{page:page},function(res){$(".container").html(res),setPic()})}),$("body").on("click","#page .page_href",function(){var page=Number($(this).text());$.get(replyCommentUrl,{page:page},function(res){$(".container").html(res),setPic()})}),$(".drfans_bread a").on("click",function(){var tag_id=$(this).data("info");$(this).addClass("active").siblings().removeClass("active"),$.get(searchUrl,{tag_id:tag_id,page:1},function(res){res.html&&($(".drfans_list").html(res.html),setPic(),res.lastPage<=1?$(".fans_loadMore").css("display","none"):($(".fans_loadMore").css("display","block"),$(".fans_loadMore").attr("totalPager",res.lastPage),$(".fans_loadMore").attr("page",1)))})}),$(".Thezang").off("click").on("click",function(){var _this=$(this),type=_this.hasClass("zangit")?1:0;$.get(setpraiseUrl,{id:postId,type:type},function(res){return res.result==-2?(ajaxLogin(),!1):void(_this.hasClass("zangit")?(_this.removeClass("zangit"),_this.find("span").html(res.praise_num)):(_this.addClass("zangit"),_this.find("span").html(res.praise_num)))},"json")}),$(document).off("click").on("click",".fans_loadMore",function(){var _this=$(this),tag_id=$(".active").data("info"),totalPager=_this.attr("page"),nextNum=parseInt(totalPager)+1,totalPager=_this.attr("totalPager");$.ajax({type:"POST",url:searchUrl,data:"page="+nextNum+"&tag_id="+tag_id,success:function(msg){msg.html&&($(".drfans_list li").last().after(msg.html),setPic(),_this.attr("page",nextNum),nextNum>=totalPager&&$(".fans_loadMore").hide())}},"json")})})});